<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Care Metaz Global - Weekly Roster Cost Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e6f2f8; /* Friendly, soft blue background */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 32px;
            border-radius: 16px; /* More rounded corners */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15); /* Stronger, softer shadow */
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 28px; /* Increased gap */
            border: 1px solid #a7d9ed; /* Subtle, branded blue border */
        }
        h1 {
            color: #1a4a72; /* Darker, more impactful blue heading */
        }
        h2 {
            color: #3f5b7a; /* Slightly darker gray-blue for section headings */
        }
        .input-section, .output-section {
            display: grid;
            gap: 20px; /* Increased gap */
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .input-group label {
            font-weight: 600; /* Slightly bolder labels */
            color: #1a4a72; /* Branded blue for labels */
        }
        .input-group input[type="number"], .input-group select, .input-group input[type="text"] {
            padding: 12px 16px; /* More padding */
            border: 1px solid #c5d0d9; /* Lighter, cooler border */
            border-radius: 10px; /* More rounded */
            font-size: 1rem;
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            background-color: #f8fafc; /* Very light background for inputs */
            -webkit-appearance: none; /* For consistent styling on iOS */
            -moz-appearance: none; /* For consistent styling on Firefox */
            appearance: none;
        }
        .input-group input[type="number"]:focus, .input-group select:focus, .input-group input[type="text"]:focus {
            outline: none;
            border-color: #2196F3; /* Brighter blue on focus */
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.4); /* More prominent shadow on focus */
        }
        .input-group.checkbox-group {
            flex-direction: row;
            align-items: center;
            gap: 10px;
            margin-top: 5px; /* Small margin to separate from previous input */
        }
        .input-group.checkbox-group input[type="checkbox"] {
            width: 20px; /* Fixed width for consistent size */
            height: 20px; /* Fixed height for consistent size */
            min-width: 20px; /* Ensure it doesn't shrink */
            min-height: 20px; /* Ensure it doesn't shrink */
            margin: 0;
            padding: 0;
            border-radius: 6px; /* Slightly more rounded checkbox */
            border: 2px solid #64b5f6; /* Blue border for checkbox */
            background-color: #bbdefb; /* Light blue background */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            -webkit-appearance: none; /* Hide default checkbox */
            -moz-appearance: none; /* Hide default checkbox */
            appearance: none;
            position: relative;
            display: inline-block;
            vertical-align: middle;
        }
        .input-group.checkbox-group input[type="checkbox"]:checked {
            background-color: #2196F3; /* Blue when checked */
            border-color: #2196F3;
        }
        .input-group.checkbox-group input[type="checkbox"]:checked::after {
            content: 'âœ”'; /* Checkmark symbol */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffffff;
            font-size: 14px;
            line-height: 1;
        }
        .input-group.checkbox-group label {
            cursor: pointer;
            font-weight: 500; /* Slightly less bold for checkbox label */
            color: #1a4a72; /* Branded blue for checkbox label */
        }
        .day-inputs {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Slightly wider cards */
            gap: 16px;
        }
        .day-card {
            background-color: #f0f4f8; /* Light blue-gray card background */
            padding: 18px; /* More padding */
            border-radius: 12px; /* More rounded */
            border: 1px solid #a7d9ed; /* Subtle branded blue border */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            gap: 8px; /* Reduced gap for more compact inputs */
        }
        .day-card:hover {
            transform: translateY(-3px); /* Slight lift on hover */
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08); /* Soft shadow on hover */
        }
        .day-card label {
            color: #1a4a72; /* Branded blue for day labels */
        }
        .day-card input[type="number"] { /* Specific styling for day inputs */
            padding: 10px 16px; /* Slightly reduced vertical padding for compactness */
            font-size: 0.95rem; /* Slightly smaller font for compactness */
        }
        .button-group {
            margin-top: 30px;
        }
        .btn {
            padding: 14px 28px; /* More padding for buttons */
            border-radius: 10px;
            font-weight: 700; /* Bolder text */
            letter-spacing: 0.025em; /* Slight letter spacing */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        .btn-primary { /* Export as PDF (Green) */
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%); /* Green gradient */
            color: #ffffff;
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #43A047 0%, #4CAF50 100%); /* Darker green on hover */
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .btn-secondary { /* Clear (Red) */
            background-color: #ef5350; /* Material Red */
            color: #ffffff; /* White text for contrast */
            border: none; /* No border for solid color */
        }
        .btn-secondary:hover {
            background-color: #e53935; /* Darker red on hover */
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .output-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Slightly larger output items */
            gap: 18px;
        }
        .output-item {
            background-color: #e9eff4; /* Darker shade of friendly blue-gray for output items */
            padding: 18px;
            border-radius: 12px;
            border: 1px solid #a7d9ed; /* Branded blue border for output items */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Soft shadow */
        }
        .output-item h3 {
            font-size: 0.95rem; /* Slightly larger heading */
            font-weight: 600;
            color: #37474f; /* Darker grey for heading */
            margin-bottom: 8px;
        }
        .output-item p {
            font-size: 1.4rem; /* Larger value font */
            font-weight: 800; /* Extra bold */
            color: #263238; /* Even darker grey for value */
        }
        .weekly-cost-summary,
        .yearly-cost-summary {
            padding: 25px; /* More padding */
            border-radius: 16px; /* More rounded */
            margin-top: 35px; /* More space */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* Stronger shadow */
        }
        .weekly-cost-summary {
            background: linear-gradient(135deg, #ff9800 0%, #fb8c00 100%); /* Orange gradient */
            color: #ffffff;
        }
        .weekly-cost-summary h3 {
            font-size: 1.3rem; /* Larger heading */
            font-weight: 700;
            color: #ffffff; /* White text for contrast */
            margin-bottom: 12px;
        }
        .weekly-cost-summary p {
            font-size: 2.5rem; /* Much larger value font */
            font-weight: 800;
            color: #ffffff; /* White text for contrast */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); /* Subtle text shadow */
        }
        .yearly-cost-summary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); /* Blue gradient */
            color: #ffffff;
        }
        .yearly-cost-summary h3 {
            font-size: 1.3rem; /* Larger heading */
            font-weight: 700;
            color: #ffffff; /* White text for contrast */
            margin-bottom: 12px;
        }
        .yearly-cost-summary p {
            font-size: 2.5rem; /* Much larger value font */
            font-weight: 800;
            color: #ffffff; /* White text for contrast */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); /* Subtle text shadow */
        }
        .disclaimer {
            font-size: 0.8rem; /* Slightly smaller disclaimer */
            color: #718096; /* Darker gray */
            padding: 15px;
            background-color: #fffbeb;
            border: 1px solid #fbd38d; /* Softer yellow border */
            border-radius: 10px;
            line-height: 1.5;
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            .input-section {
                grid-template-columns: 1fr 1fr;
            }
            .output-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .copyright {
            text-align: center;
            margin-top: 25px; /* More space */
            font-size: 0.85rem; /* Slightly larger */
            color: #a0aec0; /* Softer gray */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-6">Care Metaz Global - Weekly Roster Cost Calculator</h1>

        <div class="input-section">
            <div class="input-group">
                <label for="groupHomeAddress">Group Home Address:</label>
                <input type="text" id="groupHomeAddress" placeholder="Enter address">
            </div>
            <div class="input-group">
                <label for="gradeSelect">Select Grade/Classification:</label>
                <select id="gradeSelect">
                    <option value="custom">Custom Rate</option>
                    <option value="level2">Social & Community Services Employee Level 2</option>
                    <option value="level3">Social & Community Services Employee Level 3</option>
                    <option value="level4">Social & Community Services Employee Level 4</option>
                </select>
            </div>
            <div class="input-group">
                <label for="hourlyRate">Base Hourly Rate ($):</label>
                <input type="number" id="hourlyRate" value="25.00" step="0.01" min="0">
            </div>
            <div class="input-group">
                <label for="icareRate">Estimated ICARE Rate (Employer Cost, % of Gross):</label>
                <input type="number" id="icareRate" value="1.5" step="0.1" min="0" max="100">
            </div>
            <div class="input-group">
                <label for="sleepoverAllowance">Sleepover Allowance (per instance):</label>
                <input type="number" id="sleepoverAllowance" value="56.00" step="0.01" min="0">
            </div>
            <!-- Moved checkbox here -->
            <div class="input-group checkbox-group">
                <input type="checkbox" id="taxFreeThreshold" checked>
                <label for="taxFreeThreshold">Claim Tax-Free Threshold?</label>
            </div>
        </div>

        <h2 class="text-xl font-semibold mt-4 mb-2">Hours Worked Per Day (Weekly)</h2>
        <div class="day-inputs">
            <!-- Monday -->
            <div class="day-card">
                <label>Monday</label>
                <input type="number" id="monNormal" placeholder="Normal Hrs" step="0.5" min="0">
                <input type="number" id="monAfternoon" placeholder="Afternoon Hrs" step="0.5" min="0">
                <input type="number" id="monNight" placeholder="Night Hrs" step="0.5" min="0">
                <input type="number" id="monSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
            <!-- Tuesday -->
            <div class="day-card">
                <label>Tuesday</label>
                <input type="number" id="tueNormal" placeholder="Normal Hrs" step="0.5" min="0">
                <input type="number" id="tueAfternoon" placeholder="Afternoon Hrs" step="0.5" min="0">
                <input type="number" id="tueNight" placeholder="Night Hrs" step="0.5" min="0">
                <input type="number" id="tueSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
            <!-- Wednesday -->
            <div class="day-card">
                <label>Wednesday</label>
                <input type="number" id="wedNormal" placeholder="Normal Hrs" step="0.5" min="0">
                <input type="number" id="wedAfternoon" placeholder="Afternoon Hrs" step="0.5" min="0">
                <input type="number" id="wedNight" placeholder="Night Hrs" step="0.5" min="0">
                <input type="number" id="wedSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
            <!-- Thursday -->
            <div class="day-card">
                <label>Thursday</label>
                <input type="number" id="thuNormal" placeholder="Normal Hrs" step="0.5" min="0">
                <input type="number" id="thuAfternoon" placeholder="Afternoon Hrs" step="0.5" min="0">
                <input type="number" id="thuNight" placeholder="Night Hrs" step="0.5" min="0">
                <input type="number" id="thuSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
            <!-- Friday -->
            <div class="day-card">
                <label>Friday</label>
                <input type="number" id="friNormal" placeholder="Normal Hrs" step="0.5" min="0">
                <input type="number" id="friAfternoon" placeholder="Afternoon Hrs" step="0.5" min="0">
                <input type="number" id="friNight" placeholder="Night Hrs" step="0.5" min="0">
                <input type="number" id="friSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
            <!-- Saturday -->
            <div class="day-card">
                <label>Saturday</label>
                <input type="number" id="satHours" placeholder="Saturday Hrs" step="0.5" min="0">
                <input type="number" id="satSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
            <!-- Sunday -->
            <div class="day-card">
                <label>Sunday</label>
                <input type="number" id="sunHours" placeholder="Sunday Hrs" step="0.5" min="0">
                <!-- Removed Afternoon and Night hours for Sunday -->
                <input type="number" id="sunSleepover" placeholder="Sleepovers" step="1" min="0">
            </div>
        </div>

        <div class="output-section mt-8">
            <h2 class="text-xl font-semibold mb-4">Weekly Statistics</h2>
            <div class="output-grid">
                <div class="output-item">
                    <h3>Weekly Gross Pay</h3>
                    <p id="weeklyGrossPay">$0.00</p>
                </div>
                <div class="output-item">
                    <h3>Weekly Tax</h3>
                    <p id="weeklyTax">$0.00</p>
                </div>
                <div class="output-item">
                    <h3>Weekly Superannuation</h3>
                    <p id="weeklySuper">$0.00</p>
                </div>
                <div class="output-item">
                    <h3>Weekly Net Pay</h3>
                    <p id="weeklyNetPay">$0.00</p>
                </div>
                <div class="output-item">
                    <h3>Weekly ICARE (Employer Cost)</h3>
                    <p id="weeklyIcare">$0.00</p>
                </div>
                <div class="output-item">
                    <h3>Accrued Annual Leave (Hrs/Week)</h3>
                    <p id="annualLeaveAccrual">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Accrued Annual Leave Cost</h3>
                    <p id="annualLeaveCost">$0.00</p>
                </div>
                <div class="output-item">
                    <h3>Accrued Sick Leave (Hrs/Week)</h3>
                    <p id="sickLeaveAccrualHrs">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Accrued Sick Leave Cost</h3>
                    <p id="sickLeaveCost">$0.00</p>
                </div>
            </div>

            <h2 class="text-xl font-semibold mt-6 mb-4">Total Rostered Hours (Weekly)</h2>
            <div class="output-grid">
                <div class="output-item">
                    <h3>Total Normal Hours</h3>
                    <p id="totalNormalHours">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Total Afternoon Hours</h3>
                    <p id="totalAfternoonHours">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Total Night Hours</h3>
                    <p id="totalNightHours">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Total Saturday Hours</h3>
                    <p id="totalSaturdayHours">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Total Sunday Hours</h3>
                    <p id="totalSundayHours">0.00</p>
                </div>
                <div class="output-item">
                    <h3>Total Sleepovers</h3>
                    <p id="totalSleepovers">0</p>
                </div>
                <div class="output-item">
                    <h3>Total Hours Worked</h3>
                    <p id="totalHoursWorked">0.00</p>
                </div>
            </div>
        </div>

        <!-- Moved and styled Total Roster Cost (Weekly) -->
        <div class="weekly-cost-summary">
            <h3>Total Roster Cost (Weekly)</h3>
            <p id="totalEmployerCost">$0.00</p>
        </div>

        <!-- Yearly Roster Cost remains at the very bottom -->
        <div class="yearly-cost-summary">
            <h3>Estimated Yearly Roster Cost</h3>
            <p id="yearlyRosterCost">$0.00</p>
        </div>

        <!-- Moved buttons here -->
        <div class="button-group">
            <button id="exportPdfBtn" class="btn btn-primary">Export as PDF</button>
            <button id="clearBtn" class="btn btn-secondary">Clear</button>
        </div>

        <div class="disclaimer">
            <strong>Disclaimer:</strong> This calculator provides an *estimation* based on common interpretations and *illustrative rates* for the Community Services and Disability Award (MA000100).
            Actual pay and entitlements may vary based on your specific enterprise agreement, individual circumstances, tax declarations, and current award rates or legislation.
            **Tax calculations are simplified estimations based on illustrative weekly tax brackets (2024-2025 financial year, without Medicare Levy or HECS/HELP).**
            For precise PAYG tax, always refer to current ATO tax tables or consult a financial professional/payroll department, as it depends on many personal factors.
            **Sleepover allowance is an illustrative fixed rate per instance; actual award provisions may vary.**
            **Accrued leave costs are based on the current base hourly rate and do not account for future rate changes or leave loading.**
        </div>
        <p class="copyright">&copy; Paterson Gooley</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Changed ID from calculateBtn to exportPdfBtn
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            const clearBtn = document.getElementById('clearBtn');
            const groupHomeAddressInput = document.getElementById('groupHomeAddress'); // New input
            const gradeSelect = document.getElementById('gradeSelect');
            const hourlyRateInput = document.getElementById('hourlyRate');
            const taxFreeThresholdCheckbox = document.getElementById('taxFreeThreshold');
            const icareRateInput = document.getElementById('icareRate');
            const sleepoverAllowanceInput = document.getElementById('sleepoverAllowance');

            // Get all input fields for hours
            const dayInputs = [
                'monNormal', 'monAfternoon', 'monNight', 'monSleepover',
                'tueNormal', 'tueAfternoon', 'tueNight', 'tueSleepover',
                'wedNormal', 'wedAfternoon', 'wedNight', 'wedSleepover',
                'thuNormal', 'thuAfternoon', 'thuNight', 'thuSleepover',
                'friNormal', 'friAfternoon', 'friNight', 'friSleepover',
                'satHours', 'satSleepover',
                'sunHours', 'sunSleepover'
            ].map(id => document.getElementById(id));

            // Output elements
            const outputElements = {
                weeklyGrossPay: document.getElementById('weeklyGrossPay'),
                weeklyTax: document.getElementById('weeklyTax'),
                weeklySuper: document.getElementById('weeklySuper'),
                weeklyNetPay: document.getElementById('weeklyNetPay'),
                weeklyIcare: document.getElementById('weeklyIcare'),
                totalEmployerCost: document.getElementById('totalEmployerCost'),
                annualLeaveAccrual: document.getElementById('annualLeaveAccrual'),
                annualLeaveCost: document.getElementById('annualLeaveCost'),
                sickLeaveAccrualHrs: document.getElementById('sickLeaveAccrualHrs'),
                sickLeaveCost: document.getElementById('sickLeaveCost'),
                yearlyRosterCost: document.getElementById('yearlyRosterCost'),
                totalNormalHours: document.getElementById('totalNormalHours'),
                totalAfternoonHours: document.getElementById('totalAfternoonHours'),
                totalNightHours: document.getElementById('totalNightHours'),
                totalSaturdayHours: document.getElementById('totalSaturdayHours'),
                totalSundayHours: document.getElementById('totalSundayHours'),
                totalSleepovers: document.getElementById('totalSleepovers'),
                totalHoursWorked: document.getElementById('totalHoursWorked')
            };

            // Award Constants (based on common interpretations of MA000100)
            const AWARD_RATES = {
                NORMAL_LOADING: 1.0,      // 100% of base rate
                AFTERNOON_LOADING: 1.15,  // 15% loading
                NIGHT_LOADING: 1.30,      // 30% loading
                SATURDAY_LOADING: 1.50,   // 50% loading
                SUNDAY_LOADING: 2.00      // 100% loading
                // Sleepover allowance is handled separately as a fixed amount per instance
            };

            // Illustrative base hourly rates for different grades (These are examples and should be verified with current award)
            const GRADE_HOURLY_RATES = {
                'custom': 25.00, // Default for custom
                'level2': 28.50, // Example for Social & Community Services Employee Level 2
                'level3': 30.00, // Example for Social & Community Services Employee Level 3
                'level4': 32.50  // Example for Social & Community Services Employee Level 4
            };

            const SUPER_RATE = 0.11; // 11% of Ordinary Time Earnings (OTE)
            const ANNUAL_LEAVE_ACCRUAL_RATE_FULL_TIME_HOURS_PER_YEAR = 152; // 4 weeks x 38 hours
            const SICK_LEAVE_ACCRUAL_RATE_FULL_TIME_HOURS_PER_YEAR = 76;   // 10 days x 7.6 hours (or 2 weeks x 38 hours)
            const STANDARD_FULL_TIME_HOURS_PER_WEEK = 38; // 38 hours/week

            /**
             * Calculates estimated PAYG tax based on weekly gross pay and tax-free threshold claim.
             * These are illustrative brackets for 2024-2025, simplified and without Medicare Levy/HECS.
             * @param {number} grossPay - The weekly gross pay.
             * @param {boolean} claimTaxFreeThreshold - True if tax-free threshold is claimed.
             * @returns {number} The estimated weekly tax.
             */
            function calculatePAYGTax(grossPay, claimTaxFreeThreshold) {
                let tax = 0;

                if (claimTaxFreeThreshold) {
                    // Weekly tax rates with tax-free threshold (Illustrative 2024-2025)
                    if (grossPay <= 350) {
                        tax = 0;
                    } else if (grossPay <= 432) {
                        tax = (grossPay - 350) * 0.19;
                    } else if (grossPay <= 810) {
                        tax = 15.58 + (grossPay - 432) * 0.325;
                    } else if (grossPay <= 1519) {
                        tax = 140.68 + (grossPay - 810) * 0.37;
                    } else {
                        tax = 401.78 + (grossPay - 1519) * 0.45;
                    }
                } else {
                    // Weekly tax rates without tax-free threshold (Illustrative 2024-2025)
                    if (grossPay <= 277) {
                        tax = 0;
                    } else if (grossPay <= 369) {
                        tax = (grossPay - 277) * 0.19;
                    } else if (grossPay <= 721) {
                        tax = 17.47 + (grossPay - 369) * 0.325;
                    } else if (grossPay <= 1327) {
                        tax = 132.82 + (grossPay - 721) * 0.37;
                    } else {
                        tax = 358.57 + (grossPay - 1327) * 0.45;
                    }
                }
                return Math.max(0, tax); // Ensure tax is not negative
            }

            /**
             * Updates the hourly rate input based on the selected grade.
             */
            function updateHourlyRateFromGrade() {
                const selectedGrade = gradeSelect.value;
                if (selectedGrade !== 'custom') {
                    hourlyRateInput.value = GRADE_HOURLY_RATES[selectedGrade].toFixed(2);
                }
                // If 'custom' is selected, the user can manually enter the rate.
            }

            /**
             * Calculates all pay and leave statistics based on input hours.
             */
            function calculatePay() {
                const hourlyRate = parseFloat(hourlyRateInput.value) || 0;
                const claimTaxFree = taxFreeThresholdCheckbox.checked;
                const icareRate = parseFloat(icareRateInput.value) / 100 || 0;
                const sleepoverAllowance = parseFloat(sleepoverAllowanceInput.value) || 0;

                let totalNormalHours = 0;
                let totalAfternoonHours = 0;
                let totalNightHours = 0;
                let totalSaturdayHours = 0;
                let totalSundayHours = 0;
                let totalSleepoversCount = 0; // New variable for total sleepover instances
                let totalHoursWorked = 0; // This will only include actual working hours, not sleepover allowance hours

                let grossPayNormal = 0;
                let grossPayAfternoon = 0;
                let grossPayNight = 0;
                let grossPaySaturday = 0;
                let grossPaySunday = 0;
                let grossPaySleepovers = 0; // New variable for sleepover allowance earnings

                // Process Monday to Friday hours and sleepovers
                const daysOfWeek = ['mon', 'tue', 'wed', 'thu', 'fri'];
                daysOfWeek.forEach(day => {
                    const normalHrs = parseFloat(document.getElementById(`${day}Normal`).value) || 0;
                    const afternoonHrs = parseFloat(document.getElementById(`${day}Afternoon`).value) || 0;
                    const nightHrs = parseFloat(document.getElementById(`${day}Night`).value) || 0;
                    const sleepoverCount = parseFloat(document.getElementById(`${day}Sleepover`).value) || 0;

                    totalNormalHours += normalHrs;
                    totalAfternoonHours += afternoonHrs;
                    totalNightHours += nightHrs;
                    totalSleepoversCount += sleepoverCount;

                    grossPayNormal += normalHrs * hourlyRate * AWARD_RATES.NORMAL_LOADING;
                    grossPayAfternoon += afternoonHrs * hourlyRate * AWARD_RATES.AFTERNOON_LOADING;
                    grossPayNight += nightHrs * hourlyRate * AWARD_RATES.NIGHT_LOADING;
                    grossPaySleepovers += sleepoverCount * sleepoverAllowance;
                });

                // Process Saturday hours and sleepovers
                const satHrs = parseFloat(document.getElementById('satHours').value) || 0;
                const satSleepoverCount = parseFloat(document.getElementById('satSleepover').value) || 0;
                totalSaturdayHours += satHrs;
                totalSleepoversCount += satSleepoverCount;
                grossPaySaturday += satHrs * hourlyRate * AWARD_RATES.SATURDAY_LOADING;
                grossPaySleepovers += satSleepoverCount * sleepoverAllowance;

                // Process Sunday hours and sleepovers
                const sunHrs = parseFloat(document.getElementById('sunHours').value) || 0;
                const sunSleepoverCount = parseFloat(document.getElementById('sunSleepover').value) || 0;
                totalSundayHours += sunHrs;
                totalSleepoversCount += sunSleepoverCount;
                grossPaySunday += sunHrs * hourlyRate * AWARD_RATES.SUNDAY_LOADING;
                grossPaySleepovers += sunSleepoverCount * sleepoverAllowance;

                // Calculate total hours worked (excluding sleepover allowance as it's not "working hours" for leave accrual)
                totalHoursWorked = totalNormalHours + totalAfternoonHours + totalNightHours + totalSaturdayHours + totalSundayHours;

                // Calculate total gross pay (including sleepover allowances)
                const weeklyGrossPay = grossPayNormal + grossPayAfternoon + grossPayNight + grossPaySaturday + grossPaySunday + grossPaySleepovers;

                // Calculate superannuation (OTE generally includes ordinary hours, shift loadings, but usually not allowances like sleepovers unless specified by award/agreement)
                // For simplicity here, OTE is considered the total gross pay from ordinary and shift-loaded hours, *excluding* sleepover allowance for super calculation.
                const superableGrossPay = weeklyGrossPay - grossPaySleepovers;
                const weeklySuper = superableGrossPay * SUPER_RATE;

                // Calculate tax using the new function
                const weeklyTax = calculatePAYGTax(weeklyGrossPay, claimTaxFree);

                // Calculate ICARE (employer cost, but shown as a calculated value)
                const weeklyIcare = weeklyGrossPay * icareRate;

                // Calculate net pay
                const weeklyNetPay = weeklyGrossPay - weeklyTax;

                // Calculate Total Roster Cost (Gross Pay + Super + ICARE)
                const totalEmployerCost = weeklyGrossPay + weeklySuper + weeklyIcare;

                // Calculate Yearly Roster Cost
                const yearlyRosterCost = totalEmployerCost * 52;

                // Calculate leave accruals (pro-rata based on total *working* hours vs. full-time hours)
                // Now dividing by 52 for weekly accrual
                const proportionOfFullTime = totalHoursWorked / STANDARD_FULL_TIME_HOURS_PER_WEEK;
                const annualLeaveAccrual = (ANNUAL_LEAVE_ACCRUAL_RATE_FULL_TIME_HOURS_PER_YEAR / 52) * proportionOfFullTime; // Per week
                const sickLeaveAccrual = (SICK_LEAVE_ACCRUAL_RATE_FULL_TIME_HOURS_PER_YEAR / 52) * proportionOfFullTime;   // Per week

                // Calculate Accrued Annual Leave Cost
                const annualLeaveCost = annualLeaveAccrual * hourlyRate;
                // Calculate Accrued Sick Leave Cost
                const sickLeaveCost = sickLeaveAccrual * hourlyRate;


                // Display results
                outputElements.weeklyGrossPay.textContent = `$${weeklyGrossPay.toFixed(2)}`;
                outputElements.weeklyTax.textContent = `$${weeklyTax.toFixed(2)}`;
                outputElements.weeklySuper.textContent = `$${weeklySuper.toFixed(2)}`;
                outputElements.weeklyNetPay.textContent = `$${weeklyNetPay.toFixed(2)}`;
                outputElements.weeklyIcare.textContent = `$${weeklyIcare.toFixed(2)}`;
                outputElements.totalEmployerCost.textContent = `$${totalEmployerCost.toFixed(2)}`; // Now references the moved element
                outputElements.annualLeaveAccrual.textContent = annualLeaveAccrual.toFixed(2);
                outputElements.annualLeaveCost.textContent = `$${annualLeaveCost.toFixed(2)}`;
                outputElements.sickLeaveAccrualHrs.textContent = sickLeaveAccrual.toFixed(2); // Display hours
                outputElements.sickLeaveCost.textContent = `$${sickLeaveCost.toFixed(2)}`;   // Display cost
                outputElements.yearlyRosterCost.textContent = `$${yearlyRosterCost.toFixed(2)}`; // Display new yearly roster cost
                outputElements.totalNormalHours.textContent = totalNormalHours.toFixed(2);
                outputElements.totalAfternoonHours.textContent = totalAfternoonHours.toFixed(2);
                outputElements.totalNightHours.textContent = totalNightHours.toFixed(2);
                outputElements.totalSaturdayHours.textContent = totalSaturdayHours.toFixed(2);
                outputElements.totalSundayHours.textContent = totalSundayHours.toFixed(2);
                outputElements.totalSleepovers.textContent = totalSleepoversCount;
                outputElements.totalHoursWorked.textContent = totalHoursWorked.toFixed(2);
            }

            /**
             * Clears all input fields and resets output values.
             */
            function clearForm() {
                groupHomeAddressInput.value = ''; // Clear new input field
                gradeSelect.value = 'custom';
                hourlyRateInput.value = '25.00';
                taxFreeThresholdCheckbox.checked = true; // Default to claiming tax-free threshold
                icareRateInput.value = '1.5';
                sleepoverAllowanceInput.value = '56.00'; // Default sleepover allowance

                dayInputs.forEach(input => {
                    input.value = ''; // Set to empty string instead of '0'
                });

                for (const key in outputElements) {
                    if (outputElements.hasOwnProperty(key)) {
                        // Special handling for totalSleepovers which is a count, not currency
                        if (key === 'totalSleepovers') {
                            outputElements[key].textContent = '0';
                        } else if (key.includes('Cost') || key.includes('Pay') || key.includes('Super') || key.includes('Icare')) {
                            outputElements[key].textContent = '$0.00';
                        } else {
                            outputElements[key].textContent = '0.00';
                        }
                    }
                }
            }

            /**
             * Exports the calculator results as a PDF.
             */
            function exportPdf() {
                // Ensure calculations are up-to-date before exporting
                calculatePay();

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                let yPos = 20;
                const margin = 15;
                const lineHeight = 7;
                const headerFontSize = 14;
                const sectionHeaderFontSize = 12;
                const contentFontSize = 10;

                doc.setFontSize(headerFontSize);
                doc.text("Care Metaz Global - Weekly Roster Cost Calculator Results", margin, yPos);
                yPos += lineHeight * 2;

                // Inputs Section
                doc.setFontSize(sectionHeaderFontSize);
                doc.text("Input Parameters:", margin, yPos);
                yPos += lineHeight;
                doc.setFontSize(contentFontSize);
                doc.text(`Group Home Address: ${groupHomeAddressInput.value || 'N/A'}`, margin, yPos); // Added to PDF
                yPos += lineHeight;
                doc.text(`Grade/Classification: ${gradeSelect.options[gradeSelect.selectedIndex].text}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Base Hourly Rate: ${hourlyRateInput.value ? `$${parseFloat(hourlyRateInput.value).toFixed(2)}` : '$0.00'}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Estimated ICARE Rate: ${icareRateInput.value ? `${parseFloat(icareRateInput.value).toFixed(1)}%` : '0.0%'}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Sleepover Allowance (per instance): ${sleepoverAllowanceInput.value ? `$${parseFloat(sleepoverAllowanceInput.value).toFixed(2)}` : '$0.00'}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Claim Tax-Free Threshold: ${taxFreeThresholdCheckbox.checked ? 'Yes' : 'No'}`, margin, yPos);
                yPos += lineHeight * 2;

                // Weekly Statistics Section
                doc.setFontSize(sectionHeaderFontSize);
                doc.text("Weekly Statistics:", margin, yPos);
                yPos += lineHeight;
                doc.setFontSize(contentFontSize);
                doc.text(`Weekly Gross Pay: ${outputElements.weeklyGrossPay.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Weekly Tax: ${outputElements.weeklyTax.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Weekly Superannuation: ${outputElements.weeklySuper.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Weekly Net Pay: ${outputElements.weeklyNetPay.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Weekly ICARE (Employer Cost): ${outputElements.weeklyIcare.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Accrued Annual Leave (Hrs/Week): ${outputElements.annualLeaveAccrual.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Accrued Annual Leave Cost: ${outputElements.annualLeaveCost.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Accrued Sick Leave (Hrs/Week): ${outputElements.sickLeaveAccrualHrs.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Accrued Sick Leave Cost: ${outputElements.sickLeaveCost.textContent}`, margin, yPos);
                yPos += lineHeight * 2;

                // Total Rostered Hours Section
                doc.setFontSize(sectionHeaderFontSize);
                doc.text("Total Rostered Hours (Weekly):", margin, yPos);
                yPos += lineHeight;
                doc.setFontSize(contentFontSize);
                doc.text(`Total Normal Hours: ${outputElements.totalNormalHours.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Total Afternoon Hours: ${outputElements.totalAfternoonHours.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Total Night Hours: ${outputElements.totalNightHours.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Total Saturday Hours: ${outputElements.totalSaturdayHours.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Total Sunday Hours: ${outputElements.totalSundayHours.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Total Sleepovers: ${outputElements.totalSleepovers.textContent}`, margin, yPos);
                yPos += lineHeight;
                doc.text(`Total Hours Worked: ${outputElements.totalHoursWorked.textContent}`, margin, yPos);
                yPos += lineHeight * 2;

                // Weekly Roster Cost Summary
                doc.setFontSize(sectionHeaderFontSize + 2); // Slightly larger for emphasis
                doc.text(`Total Roster Cost (Weekly): ${outputElements.totalEmployerCost.textContent}`, margin, yPos);
                yPos += lineHeight * 2;

                // Yearly Roster Cost Summary
                doc.setFontSize(sectionHeaderFontSize + 2); // Slightly larger for emphasis
                doc.text(`Estimated Yearly Roster Cost: ${outputElements.yearlyRosterCost.textContent}`, margin, yPos);
                yPos += lineHeight * 2;

                // Disclaimer
                doc.setFontSize(contentFontSize - 2); // Smaller font for disclaimer
                const disclaimerText = document.querySelector('.disclaimer').innerText;
                const splitDisclaimer = doc.splitTextToSize(disclaimerText, 180); // Wrap text
                doc.text(splitDisclaimer, margin, yPos);
                yPos += (splitDisclaimer.length * (lineHeight - 2)); // Adjust yPos for wrapped text

                // Copyright
                doc.setFontSize(contentFontSize - 3);
                doc.text(document.querySelector('.copyright').innerText, margin, yPos + lineHeight);

                doc.save('Care_Metaz_Global_Roster_Cost_Calculator_Results.pdf');
            }

            // Event Listeners
            exportPdfBtn.addEventListener('click', exportPdf);
            clearBtn.addEventListener('click', clearForm);
            gradeSelect.addEventListener('change', updateHourlyRateFromGrade);
            taxFreeThresholdCheckbox.addEventListener('change', calculatePay);
            icareRateInput.addEventListener('input', calculatePay);
            sleepoverAllowanceInput.addEventListener('input', calculatePay);
            groupHomeAddressInput.addEventListener('input', calculatePay); // Add event listener for new input

            // Add event listeners to all day input fields for real-time updates
            dayInputs.forEach(input => {
                input.addEventListener('input', calculatePay);
            });


            // Initial calculation on load with default values
            updateHourlyRateFromGrade(); // Set initial hourly rate based on default grade selection
            calculatePay(); // Perform initial calculation to populate outputs with defaults
        });
    </script>
</body>
</html>
